# Do NOT edit this file by hand.
# This file is generated by kingdom_and_single_duchy.cue.
# You can run cue cmd dump kingdom_and_single_duchy.cue >
# kingdom_and_single_duchy_from_cue.yaml
# to regenerate it.
# TODO(uakyol): generate this from a BUILD target

apiVersion: v1
kind: Service
metadata:
  name: spanner-emulator
spec:
  selector:
    app: spanner-emulator-app
  type: ClusterIP
  ports:
    - name: grpc
      port: 9010
      protocol: TCP
      targetPort: 9010
    - name: http
      port: 9020
      protocol: TCP
      targetPort: 9020
---
apiVersion: v1
kind: Service
metadata:
  name: fake-storage-server
  annotations:
    system: testing
spec:
  selector:
    app: fake-storage-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: gcs-liquid-legions-server
  annotations:
    system: duchy
spec:
  selector:
    app: gcs-liquid-legions-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: spanner-liquid-legions-computation-storage-server
  annotations:
    system: duchy
spec:
  selector:
    app: spanner-liquid-legions-computation-storage-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: gcp-server
  annotations:
    system: duchy
spec:
  selector:
    app: gcp-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: publisher-data-server
  annotations:
    system: duchy
spec:
  selector:
    app: publisher-data-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: gcp-kingdom-storage-server
  annotations:
    system: kingdom
spec:
  selector:
    app: gcp-kingdom-storage-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: global-computation-server
  annotations:
    system: kingdom
spec:
  selector:
    app: global-computation-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: requisition-server
  annotations:
    system: kingdom
spec:
  selector:
    app: requisition-server-app
  type: ClusterIP
  ports:
    - name: port
      port: 8080
      protocol: TCP
      targetPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: spanner-emulator-pod
  labels:
    app: spanner-emulator-app
spec:
  containers:
    - name: spanner-emulator-container
      image: gcr.io/cloud-spanner-emulator/emulator
---
apiVersion: v1
kind: Pod
metadata:
  name: fake-storage-server-pod
  labels:
    app: fake-storage-server-app
  annotations:
    system: testing
spec:
  containers:
    - name: fake-storage-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/testing/storage:fake_storage_server_image
      imagePullPolicy: Never
      args:
        - --port=8080
        - --debug-verbose-grpc-server-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: liquid-legions-herald-daemon-pod
  labels:
    app: liquid-legions-herald-daemon-app
  annotations:
    system: duchy
spec:
  containers:
    - name: liquid-legions-herald-daemon-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/duchy/herald:liquid_legions_herald_daemon_image
      imagePullPolicy: Never
      args:
        - --channel-shutdown-timeout=3s
        - --computation-storage-service-target=$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_HOST):$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_PORT)
        - --global-computation-service-target=$(GLOBAL_COMPUTATION_SERVER_SERVICE_HOST):$(GLOBAL_COMPUTATION_SERVER_SERVICE_PORT)
        - --polling-interval=1m
        - --duchy-name=test-duchy-1
        - |
          --duchy-public-keys-config= entries {
            key: "combined-public-key-1"
            value {
              combined_public_key_version: 1
              elliptic_curve_id: 415
              el_gamal_generator: "\x08\x13\x46\xFE\x5A\x58\x96\x7C\xAC\xBF\xD5\xF5\x04\x36\xC5\x53\x52\xBD\xAE\xC6\x9C\x0A\x52\x14\x6B\x4A\x50\xC2\xE2\xA4\x44\x82\x8A"
              el_gamal_elements {
                key: "test-duchy-1"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-2"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-3"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              # Note: this value is random and not actually computed from the above!
              combined_el_gamal_element: "\xFF\x12\xCA\xCC\x57\xB4\x5E\xE2\x51\x73\xD2\x2D\x36\xBD\x01\xB5\x43\x7A\xC7\x11\xA0\xB7\xCE\x8D\x4E\xF6\x62\xB4\xEA\x64\x6E\xE4\x13"
            }
          }
---
apiVersion: v1
kind: Pod
metadata:
  name: gcs-liquid-legions-mill-daemon-pod
  labels:
    app: gcs-liquid-legions-mill-daemon-app
  annotations:
    system: duchy
spec:
  containers:
    - name: gcs-liquid-legions-mill-daemon-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/duchy/mill:gcs_liquid_legions_mill_daemon_image
      imagePullPolicy: Never
      args:
        - --bytes-per-chunk=2000000
        - --channel-shutdown-timeout=3s
        - --computation-control-service-target=${
        - --computation-storage-service-target=$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_HOST):$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_PORT)
        - --duchy-secret-key=
        - --global-computation-service-target=$(GLOBAL_COMPUTATION_SERVER_SERVICE_HOST):$(GLOBAL_COMPUTATION_SERVER_SERVICE_PORT)
        - --google-cloud-storage-bucket=
        - --google-cloud-storage-project=
        - --liquid-legions-decay-rate=12.0
        - --liquid-legions-size=100000
        - --metric-values-service-target=${
        - --mill-id=
        - --polling-interval=1s
---
apiVersion: v1
kind: Pod
metadata:
  name: gcs-liquid-legions-server-pod
  labels:
    app: gcs-liquid-legions-server-app
  annotations:
    system: duchy
spec:
  containers:
    - name: gcs-liquid-legions-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/internal/duchy/computation/control:gcs_liquid_legions_server_image
      imagePullPolicy: Never
      args:
        - --computation-storage-service-target=$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_HOST):$(SPANNER_LIQUID_LEGIONS_COMPUTATION_STORAGE_SERVER_SERVICE_PORT)
        - --google-cloud-storage-bucket=
        - --google-cloud-storage-project=
        - --port=8080
        - --debug-verbose-grpc-server-logging=true
        - --duchy-name=test-duchy-1
        - |
          --duchy-public-keys-config= entries {
            key: "combined-public-key-1"
            value {
              combined_public_key_version: 1
              elliptic_curve_id: 415
              el_gamal_generator: "\x08\x13\x46\xFE\x5A\x58\x96\x7C\xAC\xBF\xD5\xF5\x04\x36\xC5\x53\x52\xBD\xAE\xC6\x9C\x0A\x52\x14\x6B\x4A\x50\xC2\xE2\xA4\x44\x82\x8A"
              el_gamal_elements {
                key: "test-duchy-1"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-2"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-3"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              # Note: this value is random and not actually computed from the above!
              combined_el_gamal_element: "\xFF\x12\xCA\xCC\x57\xB4\x5E\xE2\x51\x73\xD2\x2D\x36\xBD\x01\xB5\x43\x7A\xC7\x11\xA0\xB7\xCE\x8D\x4E\xF6\x62\xB4\xEA\x64\x6E\xE4\x13"
            }
          }
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: spanner-liquid-legions-computation-storage-server-pod
  labels:
    app: spanner-liquid-legions-computation-storage-server-app
  annotations:
    system: duchy
spec:
  containers:
    - name: spanner-liquid-legions-computation-storage-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/internal/duchy/computation/storage:spanner_liquid_legions_computation_storage_server_image
      imagePullPolicy: Never
      args:
        - --port=8080
        - --spanner-database=
        - --spanner-emulator-host=$(SPANNER_EMULATOR_SERVICE_HOST):$(SPANNER_EMULATOR_SERVICE_PORT)
        - --spanner-instance=
        - --spanner-project=
        - --debug-verbose-grpc-server-logging=true
        - --duchy-name=test-duchy-1
        - |
          --duchy-public-keys-config= entries {
            key: "combined-public-key-1"
            value {
              combined_public_key_version: 1
              elliptic_curve_id: 415
              el_gamal_generator: "\x08\x13\x46\xFE\x5A\x58\x96\x7C\xAC\xBF\xD5\xF5\x04\x36\xC5\x53\x52\xBD\xAE\xC6\x9C\x0A\x52\x14\x6B\x4A\x50\xC2\xE2\xA4\x44\x82\x8A"
              el_gamal_elements {
                key: "test-duchy-1"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-2"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              el_gamal_elements {
                key: "test-duchy-3"
                value: "\x3A\x17\x79\xE4\xE2\x93\x63\x5B\x5C\xB4\xB3\x8C\xBB\xFD\x24\xB0\x7E\x29\x8D\x80\x31\xED\x6B\xEF\x42\x9F\x05\x9F\xF8\x60\xBA\x6F\x95"
              }
              # Note: this value is random and not actually computed from the above!
              combined_el_gamal_element: "\xFF\x12\xCA\xCC\x57\xB4\x5E\xE2\x51\x73\xD2\x2D\x36\xBD\x01\xB5\x43\x7A\xC7\x11\xA0\xB7\xCE\x8D\x4E\xF6\x62\xB4\xEA\x64\x6E\xE4\x13"
            }
          }
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: gcp-server-pod
  labels:
    app: gcp-server-app
  annotations:
    system: duchy
spec:
  containers:
    - name: gcp-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/internal/duchy/metricvalues:gcp_server_image
      imagePullPolicy: Never
      args:
        - --google-cloud-storage-bucket=
        - --google-cloud-storage-project=
        - --port=8080
        - --spanner-database=
        - --spanner-emulator-host=$(SPANNER_EMULATOR_SERVICE_HOST):$(SPANNER_EMULATOR_SERVICE_PORT)
        - --spanner-instance=
        - --spanner-project=
        - --debug-verbose-grpc-server-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: publisher-data-server-pod
  labels:
    app: publisher-data-server-app
  annotations:
    system: duchy
spec:
  containers:
    - name: publisher-data-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/v1alpha/publisherdata:publisher_data_server_image
      imagePullPolicy: Never
      args:
        - --duchy-name=test-duchy-1
        - --metric-values-service-target=${
        - --port=8080
        - --registration-service-target=${
        - --requisition-service-target=${REQUISITION_SERVER_SERVICE_HOST}:${REQUISITION_SERVER_SERVICE_PORT}
        - --debug-verbose-grpc-server-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: report-maker-daemon-pod
  labels:
    app: report-maker-daemon-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: report-maker-daemon-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/kingdom:report_maker_daemon_image
      imagePullPolicy: Never
      args:
        - --internal-services-target=$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_HOST):$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_PORT)
        - --max-concurrency=32
        - --throttler-overload-factor=1.2
        - --throttler-poll-delay=1ms
        - --throttler-time-horizon=2m
        - --debug-verbose-grpc-client-logging=true
---
apiVersion: v1
kind: Pod
metadata:
  name: report-starter-daemon-pod
  labels:
    app: report-starter-daemon-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: report-starter-daemon-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/kingdom:report_starter_daemon_image
      imagePullPolicy: Never
      args:
        - --internal-services-target=$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_HOST):$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_PORT)
        - --max-concurrency=32
        - --throttler-overload-factor=1.2
        - --throttler-poll-delay=1ms
        - --throttler-time-horizon=2m
        - --debug-verbose-grpc-client-logging=true
---
apiVersion: v1
kind: Pod
metadata:
  name: requisition-linker-daemon-pod
  labels:
    app: requisition-linker-daemon-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: requisition-linker-daemon-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/kingdom:requisition_linker_daemon_image
      imagePullPolicy: Never
      args:
        - --internal-services-target=$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_HOST):$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_PORT)
        - --max-concurrency=32
        - --throttler-overload-factor=1.2
        - --throttler-poll-delay=1ms
        - --throttler-time-horizon=2m
        - --debug-verbose-grpc-client-logging=true
---
apiVersion: v1
kind: Pod
metadata:
  name: gcp-kingdom-storage-server-pod
  labels:
    app: gcp-kingdom-storage-server-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: gcp-kingdom-storage-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/internal/kingdom:gcp_kingdom_storage_server_image
      imagePullPolicy: Never
      args:
        - --duchy-ids=
        - --port=8080
        - --spanner-database=
        - --spanner-emulator-host=$(SPANNER_EMULATOR_SERVICE_HOST):$(SPANNER_EMULATOR_SERVICE_PORT)
        - --spanner-instance=
        - --spanner-project=
        - --debug-verbose-grpc-server-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: global-computation-server-pod
  labels:
    app: global-computation-server-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: global-computation-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/v1alpha/globalcomputation:global_computation_server_image
      imagePullPolicy: Never
      args:
        - --duchy-ids=
        - --internal-api-target=$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_HOST):$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_PORT)
        - --port=8080
        - --debug-verbose-grpc-server-logging=true
        - --debug-verbose-grpc-client-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Pod
metadata:
  name: requisition-server-pod
  labels:
    app: requisition-server-app
  annotations:
    system: kingdom
spec:
  containers:
    - name: requisition-server-container
      image: bazel/src/main/kotlin/org/wfanet/measurement/service/v1alpha/requisition:requisition_server_image
      imagePullPolicy: Never
      args:
        - --duchy-ids=
        - --internal-api-target=$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_HOST):$(GCP_KINGDOM_STORAGE_SERVER_SERVICE_PORT)
        - --port=8080
        - --debug-verbose-grpc-server-logging=true
        - --debug-verbose-grpc-client-logging=true
      ports:
        - containerPort: 8080
---
apiVersion: batch/v1
kind: Job
metadata:
  name: push-spanner-schema-job
spec:
  template:
    spec:
      containers:
        - name: push-spanner-schema-container
          image: bazel/src/main/kotlin/org/wfanet/measurement/tools:push_spanner_schema_image
          imagePullPolicy: Never
          args:
            - --emulator-host=$(SPANNER_EMULATOR_SERVICE_HOST):$(SPANNER_EMULATOR_SERVICE_PORT)
            - --create-instance
            - --instance-config-id=spanner-emulator
            - --instance-display-name=EmulatorInstance
            - --instance-node-count=1
            - --instance-name=emulator-instance
            - --project-name=PrivateReachAndFrequencyEstimator
            - --databases=kingdom=/app/wfa_measurement_system/src/main/db/gcp/kingdom.sdl
            - --databases=duchy_metric_values=/app/wfa_measurement_system/src/main/db/gcp/metric_values.sdl
            - --databases=duchy_computations=/app/wfa_measurement_system/src/main/db/gcp/computations.sdl
      restartPolicy: OnFailure

